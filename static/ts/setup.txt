# setup
includeLibs.tx_rnbase_controller = EXT:rn_base/class.tx_rnbase_controller.php


plugin.tx_t3sportstats                = USER_INT
plugin.tx_t3sportstats.flexform       = flexform_main.xml
plugin.tx_t3sportstats.userFunc       = tx_rnbase_controller->main
plugin.tx_t3sportstats.defaultAction  = tx_t3sportstats_actions_PlayerStats
plugin.tx_t3sportstats.qualifier      = cfc_league_fe
plugin.tx_t3sportstats.templatePath   = EXT:t3sportstats/templates
plugin.tx_t3sportstats.locallangFilename = EXT:t3sportstats/locallang.xml


tt_content.list.20.tx_t3sportstats    =< plugin.tx_t3sportstats

lib.t3sports.statsData {
  pagebrowser =< lib.t3sports.pagebrowser
  roll.value = 1

  player =< lib.t3sports.profile
  goals.ifEmpty = -
  goals_per_match {
    wrap = (|)
  	number_format.decimal = 2
    # Auch an ganze Zahlen Nachkommastellen anfÃ¼gen
    number_format.dontCheckFloat = 1
    ifEmpty = -
  }
  goals_after_minutes.number_format.decimal = 0
  goals_after_minutes.number_format.dontCheckFloat = 1
  goalshome.ifEmpty = -
  goalsaway.ifEmpty = -
  goalsown.ifEmpty = -
  goalshead.ifEmpty = -
  goalshead_per_match =< lib.t3sports.statsData.goals_per_match
  goalspenalty.ifEmpty = -
  goalsjoker.ifEmpty = -
  goalsfreekick.ifEmpty = -
  assists.ifEmpty = -
  assists_per_match =< lib.t3sports.statsData.goals_per_match
  cardyellow.ifEmpty = -
  cardyr.ifEmpty = -
  cardred.ifEmpty = -
  changein.ifEmpty = -
  changeout.ifEmpty = -
}

lib.t3sports.statsFilter {
	filter = tx_t3sportstats_filter_PlayerStats
	options.what = player
	options.forcewrapper = 1
	options.groupby = PLAYERSTAT.player
	options.orderby.PLAYER.LAST_NAME = asc
	columns = played,cardyellow,cardyr,cardred,playtime,goals,assists,goalshome,goalsaway,goalshead,goalsjoker,goalsown,goalspenalty,goalsfreekick,changein,changeout
  data =< lib.t3sports.statsData
  links{
    played {
      pid = {$plugin.tx_t3sportstats.statsmatchtablepage}
      useKeepVars = 1
      useKeepVars.add = cfc_league_fe::statstype=default
    }
    goals < .played
    goals.useKeepVars.add = cfc_league_fe::statstype=default
  }
}

# Ab hier Konfiguration der einzelnen Views 
plugin.tx_t3sportstats {
  scopeTemplate = {$plugin.tx_cfcleaguefe_competition.scopeTemplate}
  playerstatsTemplate = {$plugin.tx_t3sportstats.playerstatsTemplate}

	scopeSelection =< plugin.tx_cfcleaguefe_competition.scopeSelection
  playerstats {
    default =< lib.t3sports.statsFilter
    scorerlist < .default
    scorerlist {
      filter = tx_t3sportstats_filter_PlayerStats
#      fields.PLAYERSTAT.GOALS.OP_GT_INT = 0
      options.orderby >
      options.orderby.CUSTOM = goals desc
    	options.having = sum(goals) > 0
      data =< lib.t3sports.statsData
    }
    assistlist < .default
    assistlist {
    	filter = tx_t3sportstats_filter_PlayerStats
#      fields.PLAYERSTAT.ASSISTS.OP_GT_INT = 0
    	options.orderby >
    	options.orderby.CUSTOM = assists desc
    	options.having = sum(assists) > 0
      data =< lib.t3sports.statsData
    }
  }
}

# Register freekick goal
lib.t3sports.matchreport.tickerType.cObject.13 < lib.t3sports.matchreport.tickerType.cObject.10


plugin.tx_cfcleaguefe_report {
  profileview.profile.stats {
    # Define a new statistics
    league =< lib.t3sports.statsFilter
    league {
      # Use matches from leagues only
      fields.COMPETITION.TYPE.OP_EQ_INT = 1
      # Use obligate matches only
      fields.COMPETITION.OBLIGATION.OP_EQ_INT = 1
    }
  }
}
plugin.tx_cfcleaguefe_competition {
  matchtable.filter.stats {
    default =< lib.t3sports.statsFilter
  }
}
